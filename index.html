<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RNN Cell Visualizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f1115;
      --panel: #1e242b;
      --accent: #4aa3ff;
      --accent-glow: #90c9ff;
      --text: #eef3f8;
      --muted: #94a3b8;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    }
    html, body { height:100%; margin:0; background:var(--bg); color:var(--text); }
    body { display:flex; align-items:center; justify-content:center; padding:2rem; box-sizing:border-box; }
    .stage { position:relative; display:flex; align-items:center; justify-content:center; min-height:480px; min-width:760px; }

  .cell-wrapper { position:relative; display:flex; align-items:center; gap:2.5rem; }
  .cell-stack { display:flex; flex-direction:column; align-items:center; position:relative; }
  /* Vertical centering refinement: exclude input below cell */
  .cell-stack { position:relative; }
  .input-scalar { margin-top:0.75rem; }
  /* Increase vertical lift of side blocks; rely on flex centering + larger offset */
  .prev-state { margin-top:-90px; }
  .output-wrap { margin-top:-90px; }

    .prev-state { display:flex; flex-direction:column; gap:0.5rem; margin-right:2.5rem; font-size:0.95rem; }
    .output-wrap { display:flex; align-items:center; }
    .prev-state .label { font-weight:600; letter-spacing:0.5px; color:var(--muted); text-align:center; }
    .vector { display:flex; flex-direction:column; gap:0.4rem; }
    .vector .component { background:var(--panel); border:1.5px solid var(--accent); padding:0.45rem 0.85rem; border-radius:6px; min-width:54px; text-align:center; font-weight:500; position:relative; }
    .vector .component::after { content:""; position:absolute; inset:0; border-radius:6px; box-shadow:0 0 0 0 rgba(74,163,255,0.6); transition:box-shadow 0.4s; }
    .vector .component:hover::after { box-shadow:0 0 0 3px rgba(74,163,255,0.25); }
  .state-projection { display:flex; align-items:center; gap:0.6rem; margin-top:0.35rem; flex-wrap:wrap; justify-content:center; }
  .matrix { display:flex; flex-direction:column; gap:0.25rem; }
  .matrix-row { display:flex; gap:0.25rem; }
  .matrix-cell { background:var(--panel); border:1.5px solid var(--accent); padding:0.35rem 0.55rem; border-radius:4px; min-width:44px; text-align:center; font-size:0.75rem; font-weight:500; }
  .matrix-label { font-size:0.7rem; color:var(--muted); text-align:center; margin-top:0.1rem; }
  .equals { font-weight:700; color:var(--text); opacity:0.9; }
  .op-sm { width:30px; height:30px; border-radius:50%; border:1.5px solid var(--accent); display:grid; place-items:center; font-size:0.9rem; background:var(--panel); font-weight:600; }
  .projection-result .vector .component { border-style:dashed; }

  .rnn-cell { width:360px; height:360px; border:4px solid var(--accent); border-radius:18px; background:linear-gradient(145deg, #1b232c, #252f39); position:relative; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:600; letter-spacing:1px; padding:0.75rem; box-sizing:border-box; }
  .rnn-cell::before { content:"RNN Cell"; position:absolute; top:-1.95rem; left:50%; transform:translateX(-50%); font-size:1rem; font-weight:500; color:var(--muted); letter-spacing:0.75px; }
  .inside-equation { width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:1rem; }
  .sum-stack { display:flex; align-items:center; gap:0.6rem; flex-wrap:wrap; justify-content:center; }
  .vec-col { display:flex; flex-direction:column; gap:0.35rem; align-items:center; }
  /* Inner vectors smaller (override external size) */
  .inside-equation .vec-col .vector .component { min-width:48px; padding:0.30rem 0.55rem; font-size:0.75rem; }
  .plus, .equals-big { font-size:1.2rem; font-weight:800; color:var(--text); opacity:0.9; }
  .bias .component { border-style:dotted; }
  .z-vector .component { border-style:solid; border-color:#7ee787; }
  .z-label { font-size:0.8rem; color:#9bd7a2; margin-top:0.15rem; }
  .next-state { display:flex; flex-direction:column; gap:0.5rem; font-size:0.95rem; }
  .next-state .label { font-weight:600; letter-spacing:0.5px; color:var(--muted); text-align:center; }
  .arrow-horizontal { width:60px; height:2px; background:var(--accent); position:relative; margin:0 0.75rem; }
  .arrow-horizontal:after { content:""; position:absolute; right:0; top:50%; transform:translateY(-50%); width:0; height:0; border-left:10px solid var(--accent); border-top:6px solid transparent; border-bottom:6px solid transparent; }
  .output-wrap { display:flex; align-items:center; }

  .input-scalar { position:static; margin-top:1.25rem; font-size:1.05rem; display:flex; flex-direction:column; align-items:center; gap:0.55rem; }
  .input-scalar .input-row { display:flex; align-items:center; gap:0.8rem; }
  .input-scalar .value { background:var(--panel); border:1.5px solid var(--accent); padding:0.55rem 1.1rem; border-radius:40px; font-weight:500; min-width:48px; text-align:center; }
  .input-scalar .label { font-size:0.8rem; text-transform:uppercase; letter-spacing:1px; color:var(--muted); text-align:center; }
  .op { width:34px; height:34px; border-radius:50%; border:1.5px solid var(--accent); display:grid; place-items:center; color:var(--text); font-weight:700; background:var(--panel); }
  .weights { display:flex; align-items:center; gap:0.5rem; }
  .weights .vector { gap:0.35rem; }
  .vector-label { font-size:0.8rem; color:var(--muted); text-align:center; margin-top:0.15rem; }
  .equals { font-weight:700; color:var(--text); opacity:0.9; margin:0 0.25rem; }
  .result .vector .component { border-style:dashed; }

    /* Connectors */
    .arrow { position:absolute; width:120px; height:2px; background:var(--accent); left:0; top:0; }

    .connector { position:absolute; pointer-events:none; }
    svg { overflow:visible; }
    .connector path { stroke:var(--accent); stroke-width:3; fill:none; stroke-linecap:round; filter:drop-shadow(0 0 4px rgba(74,163,255,0.5)); }
    .connector marker path { filter:none; }

    /* Responsive tweak */
    @media (max-width: 900px) {
      body { padding:1rem; }
      .stage { flex-direction:column; min-width:unset; }
      /* Reset lifted margins on narrow screens for readability */
      .prev-state { flex-direction:row; margin-right:0; margin-bottom:1.5rem; margin-top:0; }
      .output-wrap { margin-top:0; }
      .vector { flex-direction:row; }
      .rnn-cell { width:260px; height:260px; }
      .input-scalar { margin-top:1rem; }
    }
  </style>
</head>
<body>
  <div class="stage">
    <div class="cell-wrapper">
  <div class="prev-state" aria-label="previous hidden state">
        <div class="label">h_prev</div>
        <div class="state-projection" aria-label="hidden state projection">
          <div class="matrix" id="WhMatrix">
            <div class="matrix-row">
              <div class="matrix-cell" title="w₁₁">w₁₁</div>
              <div class="matrix-cell" title="w₁₂">w₁₂</div>
              <div class="matrix-cell" title="w₁₃">w₁₃</div>
            </div>
            <div class="matrix-row">
              <div class="matrix-cell" title="w₂₁">w₂₁</div>
              <div class="matrix-cell" title="w₂₂">w₂₂</div>
              <div class="matrix-cell" title="w₂₃">w₂₃</div>
            </div>
            <div class="matrix-row">
              <div class="matrix-cell" title="w₃₁">w₃₁</div>
              <div class="matrix-cell" title="w₃₂">w₃₂</div>
              <div class="matrix-cell" title="w₃₃">w₃₃</div>
            </div>
            <div class="matrix-label">W_h</div>
          </div>
          <div class="op-sm">×</div>
          <div class="vector" id="hPrevVec">
            <div class="component">h₁</div>
            <div class="component">h₂</div>
            <div class="component">h₃</div>
          </div>
          <div class="vector-label" style="margin-top:0.15rem; font-size:0.7rem;">h_prev</div>
          <div class="equals">=</div>
          <div class="projection-result">
            <div class="vector" id="WhhPrev">
              <div class="component" title="r₁">r₁</div>
              <div class="component" title="r₂">r₂</div>
              <div class="component" title="r₃">r₃</div>
            </div>
            <div class="vector-label" style="margin-top:0.15rem; font-size:0.7rem;">W_h h_prev</div>
          </div>
        </div>
      </div>
  <div class="cell-stack">
        <div class="rnn-cell" id="rnnCell">
          <div class="inside-equation" aria-label="pre-activation sum">
            <div class="sum-stack">
              <div class="vec-col">
                <div class="vector">
                  <div class="component">r₁</div>
                  <div class="component">r₂</div>
                  <div class="component">r₃</div>
                </div>
                <div class="vector-label">W_h h_prev</div>
              </div>
              <div class="plus">+</div>
              <div class="vec-col">
                <div class="vector">
                  <div class="component">w₁·x</div>
                  <div class="component">w₂·x</div>
                  <div class="component">w₃·x</div>
                </div>
                <div class="vector-label">W_x x</div>
              </div>
              <div class="plus">+</div>
              <div class="vec-col bias">
                <div class="vector">
                  <div class="component">b₁</div>
                  <div class="component">b₂</div>
                  <div class="component">b₃</div>
                </div>
                <div class="vector-label">b</div>
              </div>
              <div class="equals-big">=</div>
              <div class="vec-col z-vector">
                <div class="vector">
                  <div class="component" title="z₁">z₁</div>
                  <div class="component" title="z₂">z₂</div>
                  <div class="component" title="z₃">z₃</div>
                </div>
                <div class="z-label">z = W_h h_prev + W_x x + b</div>
              </div>
            </div>
          </div>
        </div>
        <div class="input-scalar" aria-label="current input and weights multiplication">
        <div class="input-row">
          <div class="weights">
            <div class="vector">
              <div class="component" title="w₁">w₁</div>
              <div class="component" title="w₂">w₂</div>
              <div class="component" title="w₃">w₃</div>
            </div>
            <div class="vector-label">W_x</div>
          </div>
          <div class="op" aria-hidden="true">×</div>
          <div class="value" id="inputX" title="scalar input x">x</div>
          <div class="equals">=</div>
          <div class="result">
            <div class="vector">
              <div class="component" title="w₁·x">w₁·x</div>
              <div class="component" title="w₂·x">w₂·x</div>
              <div class="component" title="w₃·x">w₃·x</div>
            </div>
            <div class="vector-label">W_x x</div>
          </div>
        </div>
        <div class="label">input projection</div>
        </div>
      </div>
  <div class="output-wrap" aria-label="activation output">
        <div class="arrow-horizontal" title="tanh"></div>
        <div class="next-state">
          <div class="label">h_new = tanh(z)</div>
          <div class="vector">
            <div class="component" title="h₁^{new}">h₁'</div>
            <div class="component" title="h₂^{new}">h₂'</div>
            <div class="component" title="h₃^{new}">h₃'</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Minimal placeholder JS (reserved for future steps)
  </script>
</body>
</html>
